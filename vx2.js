var qroom,thisNumRand,webrtc=new SimpleWebRTC({remoteVideosEl:"remotesVideos",localVideoEl:"localVideo",autoRequestMedia:!0,detectSpeakingEvents:!0,autoAdjustMic:!1,url:"https://www.hokucode.com/",socketio:{path:"/signal/socket.io"},enableDataChannels:!0,media:{video:!1,audio:!0},debug:!0}),acc=!1;function showVolume(e,t){e&&(t<-45&&(t=-45),t>-20&&(t=-20),e.value=t)}function track(e,t){webrtc&&webrtc.connection&&webrtc.connection.emit("metrics",e,t||{})}"http:"==location.protocol&&alert("Please use https://www. on our page, otherwise RTC will not function."),webrtc.on("createdPeer",function(e){for(var t=e.id.substring(0,6),n=0;n<6;n+=1){var c=0,o=t[n];c+=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","1","2","3","4","5","6","7","8","9","0","-"].indexOf(o)+1,0==n&&(thisNumRand=26291*c)}var i=document.getElementById("remotes");if(i){var a=document.createElement("div");a.className="peerContainer",a.id="container_"+webrtc.getDomId(e);var r=document.createElement("tr"),s=document.createElement("th"),d=document.createElement("h3");d.style.color="#"+thisNumRand,txn=document.createTextNode("Anon "+thisNumRand),d.appendChild(txn),s.appendChild(d);var l=document.createElement("th"),m=document.createElement("th"),p=document.createElement("img");p.src="speaker.png",p.height=50,p.width=50;var u=document.createElement("a"),h=document.createElement("meter");h.id="volume_"+e.id,h.className="volume",h.min=-45,h.max=-20,h.low=-40,h.high=-25,l.appendChild(u),u.appendChild(p),m.appendChild(h),r.appendChild(l),r.appendChild(s),r.appendChild(m),a.appendChild(r),i.appendChild(a);var w=!0;u.onclick=function(){var t="#"+webrtc.getDomId(e);w=!w;var n=e.id;0==w?($(t).prop("muted",!0),p.src="muted.png",webrtc.sendDirectlyToAll("channelMessage","chat",{messageBody:"m",cid:n})):($(t).prop("muted",!1),p.src="speaker.png",webrtc.sendDirectlyToAll("channelMessage","chat",{messageBody:"u",cid:n}))},e&&e.pc&&(e.firsttime=!0,e.pc.on("iceConnectionStateChange",function(t){var n=e.pc.iceConnectionState;switch(a.className="peerContainer p2p"+n.substr(0,1).toUpperCase()+n.substr(1),n){case"connected":case"completed":u.style.visibility="visible",e.firsttime&&(e.firsttime=!1,track("iceSuccess",{session:e.sid,peerprefix:e.browserPrefix,prefix:webrtc.capabilities.prefix,version:webrtc.capabilities.browserVersion}));break;case"closed":a.remove()}})),i.appendChild(a)}}),webrtc.on("volumeChange",function(e,t){showVolume(document.getElementById("localVolume"),e)}),webrtc.on("remoteVolumeChange",function(e,t){showVolume(document.getElementById("volume_"+e.id),t)});var totalSeconds=0;function setTime(){(totalSeconds+=1)>300&&(webrtc.leaveRoom(),rmc("ind"))}setInterval(setTime,1e3);var rba,px=!0;function mute(){1==(px=!px)?(webrtc.unmute(),$("#urimg").attr("src","speaker.png")):(webrtc.mute(),$("#urimg").attr("src","muted.png"))}function rmc(e){"ind"!=e?(webrtc.leaveRoom(),webrtc.joinRoom(e),rba=e,$("#bdrp").text(e),vxt("v")):(webrtc.stopLocalVideo(),webrtc.leaveRoom(),$("#bdrp").text(""),vxt("i"))}function tsh(){$("#tos").css("display","inline")}function vxt(e){"i"==e?($("#indiv").css("display","none"),$("#cdiv").css("display","inline")):($("#indiv").css("display","inline"),$("#cdiv").css("display","none"))}window.addEventListener("load",function(){rmc("ind"),null!=location.search.match(/room=([a-z0-9]+)/)&&(qroom=location.search.match(/room=([a-z0-9]+)/)[1],snt())},!1);var pmu=0;webrtc.on("channelMessage",function(e,t,n){var c=document.getElementsByClassName("p2pCompleted").length+document.getElementsByClassName("p2pConnected").length;"chat"===n.type&&n.payload.cid==webrtc.connection.getSessionid()&&("m"==n.payload.messageBody?pmu+=1:"u"==n.payload.messageBody&&pmu>0&&(pmu-=1),pmu==c&&c>1&&(webrtc.stopLocalVideo(),webrtc.leaveRoom(),rmc("ind")))});var ldd=!0;function snt(){1==ldd&&(rmc(qroom),ldd=!1)}var sbut=document.getElementById("xt");jQuery(document).ready(function(e){e("#capform").motionCaptcha({shapes:["triangle","x","rectangle","circle","check","zigzag","arrow","delete","pigtail","star"]}),sbut.disabled=!0});var ticsc=0,initialized=!1;function offtick(){ticsc+=1,console.log(ticsc),st=document.getElementById("indi"),st.innerHTML=1200-ticsc+" seconds remaining",ticsc>1200&&(st.innerHTML="session expired...",window.location.reload()),ticsc>1320&&(rmc("ind"),webrtc.leaveRoom())}function timerenew(){ticsc=0,sbut.disabled=!0}setInterval(offtick,1e3);//All code excluding jquery, swrtc library, motioncaptcha is the property of JST.